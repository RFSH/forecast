function processJSON(t){putNowTabValues(t);for(var e="",a=1;26>a;a++)try{e+=createHourRow(t.hourly.data[a],a,t.thisCity)}catch(i){}""==e&&(e+="<tr><td colspan='5'><div class='alert alert-warning'>There is no daily data for this location.</div></td></tr>"),$(".table.days-table tbody").html(e);for(var n="",s=1;8>s;s++)try{n+=createDayCard(t.daily.data[s],s,t.thisCity)}catch(i){}""==n&&(n+="<div class='alert alert-warning'>There is no week data for this location.</div>"),$(".day-cards").html(n),correctUnits(t.thisUnit)}function getIcon(t){switch(t){case"clear-day":return"clear.png";case"clear-night":return"clear_night.png";case"rain":return"rain.png";case"snow":return"snow.png";case"sleet":return"sleet.png";case"wind":return"wind.png";case"fog":return"fog.png";case"cloudy":return"cloudy.png";case"partly-cloudy-day":return"cloud_day.png";case"partly-cloudy-night":return"cloud_night.png";default:return"clear.png"}}function correctUnits(t){"us"==t?($(".temp-unit").html("&#8457"),$(".speed-unit").html("mph"),$(".distance-unit").html("mi"),$(".pressure-unit").html("mb")):($(".temp-unit").html("&#8451"),$(".speed-unit").html("m/s"),$(".distance-unit").html("km"),$(".pressure-unit").html("hPa"))}function findPrecipitation(t,e){return"si"==e&&(t*=.0393701),.002>t?"None":.017>t?"Very Light":.1>t?"Light":.4>t?"Moderate":"Heavy"}function putNowTabValues(t){$(".now-current .image img").attr("src",imagesSRC+getIcon(t.currently.icon)).attr("alt",t.currently.summary).attr("title",t.currently.summary),$(".now-current .summary").html(t.currently.summary),$(".now-current .city-name").html(t.thisCity+", "+t.thisState),$(".now-current h1 .weather").html(parseInt(t.currently.temperature)),$(".now-current .low-temp").html(parseInt(t.daily.data[0].temperatureMin)),$(".now-current .high-temp").html(parseInt(t.daily.data[0].temperatureMax)),fbOk=!0,fbParams.name="Current Weather in "+t.thisCity+", "+t.thisState,fbParams.description=t.currently.summary+", "+parseInt(t.currently.temperature)+"Â°"+("us"==t.thisUnit?"F":"C"),fbParams.picture="http://cs-server.usc.edu:45678/hw/hw8/images/"+getIcon(t.currently.icon),$(".now-current .now-precipitation").html(findPrecipitation(parseFloat(t.currently.precipIntensity),t.thisUnit)),$(".now-current .now-rainchance span").html(100*parseInt(t.currently.precipProbability)),$(".now-current .now-wind .num").html(parseFloat(t.currently.windSpeed)),$(".now-current .now-dew .num").html(parseFloat(t.currently.dewPoint)),$(".now-current .now-visibility .num").html(parseFloat(t.currently.visibility)),$(".now-current .now-humidity span").html(parseInt(t.currently.humidity)),$(".now-current .now-sunrise").html(moment.tz(new Date(1e3*t.daily.data[0].sunriseTime),t.timezone).format("hh:mm A")),$(".now-current .now-sunset").html(moment.tz(new Date(1e3*t.daily.data[0].sunsetTime),t.timezone).format("hh:mm A"))}function createHourRow(t,e){var a="<tr>";return a+="<td>"+(void 0!=t.time?moment.tz(new Date(1e3*t.time),t.timezone).format("hh:mm A"):"N/A")+"</td>",t.icon?(a+="<td><img width='40' height='40' src='"+imagesSRC+getIcon(t.icon)+"'",a+=" alt='"+(t.summary?t.summary:"")+"'",a+=" title='"+(t.summary?t.summary:"")+"'",a+="/></td>"):a+="<td>N/A</td>",a+="<td>"+(void 0!=t.cloudCover?parseInt(100*parseFloat(t.cloudCover)):"N/A")+"%</td>",a+="<td>"+(void 0!=t.temperature?parseFloat(t.temperature):"N/A")+"</td>",a+='<td><a role="button" data-toggle="collapse" href="#tab-day-details-'+e+'">',a+='<i class="glyphicon glyphicon-plus"></i></td></tr>',a+='<tr class="tab-day-row-collapse"><td colspan="5">',a+='<div id="tab-day-details-'+e+'" class="collapse well"><div class="table-responsive">',a+='<table class="table details-table"><thead><tr><th>Wind</th><th>Humidity</th>',a+="<th>Visibility</th><th>Pressure</th></tr></thead><tbody><tr>",a+="<td>"+(void 0!=t.windSpeed?t.windSpeed:"N/A")+"<span class='speed-unit'></span></td>",a+="<td>"+(void 0!=t.humidity?parseInt(100*parseFloat(t.humidity)):"N/A")+"%</td>",a+="<td>"+(void 0!=t.visibility?t.visibility:"N/A")+"<span class='distance-unit'></span></td>",a+="<td>"+(void 0!=t.pressure?t.pressure:"N/A")+"<span class='pressure-unit'></span></td>",a+="</tr></tbody></table></div></div></td></tr>"}function createDayCard(t,e,a){var i=t.time?moment.tz(new Date(1e3*t.time),t.timezone).format("MMM D"):"N/A",n=t.time?moment.tz(new Date(1e3*t.time),t.timezone).format("dddd"):"N/A",s='<div class="col-lg-1 col-md-1 col-xs-11 col-sm-11 day-card day-card-'+e+'" data-toggle="modal" ';return s+='data-target="#show-details-modal-'+e+'" >',s+="<h4 class='day'>"+n+"</h4>",s+="<h4 class='date'>"+i+"</h4>",t.icon&&(s+="<img width='70' height='70' src='"+imagesSRC+getIcon(t.icon)+"'",s+=" alt='"+(t.summary?t.summary:"")+"'",s+=" title='"+(t.summary?t.summary:"")+"'",s+="/>"),s+="<h5>Min</h5><h5>Temp</h5>",s+="<h2>"+(void 0!=t.temperatureMin?parseInt(t.temperatureMin):"N/A")+"&deg;</h2>",s+="<h5>Max</h5><h5>Temp</h5>",s+="<h2>"+(void 0!=t.temperatureMax?parseInt(t.temperatureMax):"N/A")+"&deg;</h2>",s+="</div>",s+="<div id='show-details-modal-"+e+"' class='modal fade' role='dialog'>",s+='<div class="modal-dialog"><div class="modal-content"><div class="modal-header">',s+='<button type="button" class="close" data-dismiss="modal">&times;</button>',s+='<h4 class="modal-title">Weather in '+a+" on "+i+"</h4>",s+='</div><div class="modal-body">',t.icon&&(s+="<img width='250' height='220' src='"+imagesSRC+getIcon(t.icon)+"'",s+=" alt='"+(t.summary?t.summary:"")+"'",s+=" title='"+(t.summary?t.summary:"")+"'",s+="/>"),s+="<div><h3>"+n+': <span class="orange">'+(t.summary?t.summary:"N/A")+"</span></h3></div>",s+='<div class="row"><div class="col-md-4 col-xs-12 col-sm-12">',s+="<h4>Sunrise Time</h4>",s+="<div>"+(void 0!=t.sunriseTime?moment.tz(new Date(1e3*t.sunriseTime),t.timezone).format("hh:mm A"):"N/A")+"</div>",s+="<h4>Wind Speed</h4>",s+="<div>"+(void 0!=t.windSpeed?t.windSpeed:"N/A")+'<span class="speed-unit"></span></div></div>',s+='<div class="col-md-4 col-xs-12 col-sm-12"><h4>Sunset Time</h4>',s+="<div>"+(void 0!=t.sunsetTime?moment.tz(new Date(1e3*t.sunsetTime),t.timezone).format("hh:mm A"):"N/A")+"</div>",s+="<h4>Visibility</h4>",s+="<div>"+(void 0!=t.visibility?t.visibility+"<span class='distance-unit'></span>":"N/A")+"</div></div>",s+='<div class="col-md-4 col-xs-12 col-sm-12"><h4>Humidity</h4>',s+="<div>"+(void 0!=t.humidity?parseInt(100*parseFloat(t.humidity)):"N/A")+"%</div>",s+="<h4>Pressure</h4>",s+="<div>"+(void 0!=t.pressure?t.pressure+'<span class="pressure-unit"></span>':"N/A")+"</div></div></div></div>",s+='<div class="modal-footer">',s+='<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>',s+="</div></div></div></div>"}function addMap(t,e){$("#now-map").html("");var a=new OpenLayers.LonLat(e,t);a.transform(coor_from,coor_to),map=new OpenLayers.Map("now-map",{numZoomLevels:2});var i=new OpenLayers.Layer.OSM,n=new OpenLayers.Layer.XYZ("clouds","http://${s}.tile.openweathermap.org/map/clouds/${z}/${x}/${y}.png",{isBaseLayer:!1,opacity:.4,sphericalMercator:!0}),s=new OpenLayers.Layer.XYZ("precipitation","http://${s}.tile.openweathermap.org/map/precipitation/${z}/${x}/${y}.png",{isBaseLayer:!1,opacity:.4,sphericalMercator:!0});map.addLayers([i,s,n]),map.setCenter(a,9),$("img").error(function(){$(this).attr("src","static/images/missing.jpg")})}function changeMapCenter(t,e){var a=new OpenLayers.LonLat(e,t);a.transform(coor_from,coor_to),map.setCenter(a,9)}function addFBPost(){fbOk&&FB.ui(fbParams,function(t){void 0==t||null==t||t.error_message?show_message("","Not Posted","warning"):show_message("","Posted Successfully","success")})}function resetForm(){document.getElementById("city").value="",document.getElementById("address").value="",document.getElementById("state").value="",document.getElementById("us-degree").checked=!0,validator&&validator.resetForm(),$("#result-box").hide()}function show_message(t,e,a){alert(e)}$(function(){$.fn.initialize=function(t,e){var a=this,i=a.selector;if("function"!=typeof t||!i)return $(a);var n=$("body")[0];if(a.firstInitsCalled=a.firstInitsCalled||[],"function"==typeof e&&-1==a.firstInitsCalled.indexOf(e)&&(a.firstInitsCalled.push(e),e()),a.initData=a.initData||{},a.initData[i]=a.initData[i]||[],a.initData[i].push(t),$(this).each(function(){this.initsCalled=this.initsCalled||[],-1==this.initsCalled.indexOf(t)&&(this.initsCalled.push(t),$(this).each(t))}),!this.initializedObserver){this.initializedObserver=!0,window.MutationObserver=window.MutationObserver||window.WebKitMutationObserver;var s=new MutationObserver(function(t){$.each(t,function(t,e){var n=$();"attributes"==e.type&&(n=$(e.target)),"childList"==e.type&&e.addedNodes.length&&$.each(e.addedNodes,function(t,e){n=n.add(e)});for(i in a.initData){var s=a.initData[i],r=n.find(i);n.is(i)&&(r=r.add(n)),r.each(function(){var t=this;t.initsCalled=t.initsCalled||[],$.each(s,function(e,a){-1==t.initsCalled.indexOf(a)&&(t.initsCalled.push(a),$(t).each(a))})})}})}),r={attributes:!0,childList:!0,characterData:!1,subtree:!0};s.observe(n,r)}return $(this)}});var imagesSRC="static/images/",map,coor_from=new OpenLayers.Projection("EPSG:4326"),coor_to=new OpenLayers.Projection("EPSG:900913"),fbParams={method:"feed",caption:"WEATHER INFORMATION FROM FORECAST.IO",name:"",link:"http://forecast.io",description:"",message:""},fbOk=!1;window.fbAsyncInit=function(){FB.init({appId:"950680011671276",xfbml:!0,version:"v2.5"})},function(t,e,a){var i,n=t.getElementsByTagName(e)[0];t.getElementById(a)||(i=t.createElement(e),i.id=a,i.src="//connect.facebook.net/en_US/sdk.js",n.parentNode.insertBefore(i,n))}(document,"script","facebook-jssdk");var validator;jQuery(function(){validator=$("#search-form").validate({submitHandler:function(t){$('a[href="#tab-now"]').tab("show"),$.ajax({type:"get",url:"forecast.php",data:$(t).serialize(),dataType:"json",beforeSend:function(){$(".buttons button").attr("disabled","disabled"),$(".content").hide(),$("#load-spinner").show()},success:function(t){$(".buttons button").removeAttr("disabled"),$("#load-spinner").hide(),"success"==t.op_status?(tdata=t,$(".content").show(),processJSON(t),addMap(parseFloat(t.latitude),parseFloat(t.longitude))):show_message("Error",t.message,"error")},error:function(t){$(".buttons button").removeAttr("disabled"),$("#load-spinner").hide(),show_message("Oops..","There was a problem with the connection, Try Again.","error")}})},rules:{address:"required",city:"required",state:"required"},messages:{address:"Please enter the street address",city:"Please enter the city",state:"Please select a state"}}),jQuery("#reset").click(function(){resetForm()}),$(".now-clouds").css("height",$(".now-current").height()),$(".content").hide()}),$(window).bind("load",function(){$("img").each(function(){("undefined"!=typeof this.naturalWidth&&0==this.naturalWidth||"uninitialized"==this.readyState)&&($(this).attr("src","static/images/missing.jpg"),$(this).html("<span>Image Not Found</span>"))})}),$(function(){$(".olImageLoadError").initialize(function(){$(this).attr("src","static/images/missing.jpg")})}),$(window).resize(function(){$(".tab-day-row-collapse td .well").css("width",$("#tab-day").width())});